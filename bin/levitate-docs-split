#!/bin/bash
#
# levitate-docs-split - Split-screen docs TUI launcher with tmux
#
# Creates a tmux session with:
#   LEFT PANE: Interactive shell
#   RIGHT PANE: Docs TUI
#

set -e

# Check if tmux is installed
if ! command -v tmux &> /dev/null; then
    cat >&2 << 'EOF'
Error: tmux is required for split-screen docs

Install tmux using your package manager:
  Arch/Manjaro:    sudo pacman -S tmux
  Fedora/Rocky:    sudo dnf install tmux
  Debian/Ubuntu:   sudo apt install tmux
  macOS:           brew install tmux

Or run in full-screen mode:
  bun src/index.ts
EOF
    exit 1
fi

SESSION_NAME="levitate-docs"
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"

# Check if session already exists
if tmux has-session -t "$SESSION_NAME" 2>/dev/null; then
    # Reattach to existing session
    exec tmux attach-session -t "$SESSION_NAME"
fi

# Create new tmux session in detached mode
tmux new-session -d -s "$SESSION_NAME" -x 160 -y 40

# Split horizontally (left/right) at 50% width
tmux split-window -h -t "$SESSION_NAME" -p 50

# Right pane: docs TUI in tmux mode
tmux send-keys -t "$SESSION_NAME:0.1" "cd '$SCRIPT_DIR' && bun src/index.ts --tmux-mode" Enter

# Left pane: user's shell (already active)
# Just make sure it's the active pane
tmux select-pane -t "$SESSION_NAME:0.0"

# Attach to session
exec tmux attach-session -t "$SESSION_NAME"
